
local FSection = Tab:NewSection("Fling")
local selectedPlayer = nil
local playerOptions = {}
local playerMap = {}
local flingDropdown = nil
local function flingPlayer(target)
    if not target or not target.Character then
        notif("Invalid target", 2)
        return
    end

    local character = target.Character
    local rootPart = character:FindFirstChild("HumanoidRootPart") 
                  or character:FindFirstChild("Torso") 
                  or character:FindFirstChild("UpperTorso")

    if not rootPart then
        notif("Could not find root part", 2)
        return
    end

    local thrust = Instance.new("BodyThrust")
    thrust.Force = Vector3.new(0, 100000, 0)
    thrust.Location = rootPart.Position
    thrust.Parent = rootPart

    task.wait(0.5)
    thrust:Destroy()

    notif("Flinged " .. target.Name, 2)
end

-- Update player dropdown
local function updateFlingDropdown()
    playerOptions = {}
    playerMap = {}

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Players.LocalPlayer then
            local label = player.DisplayName .. " (@" .. player.Name .. ")"
            table.insert(playerOptions, label)
            playerMap[label] = player
        end
    end

    if flingDropdown then
        flingDropdown:Refresh(playerOptions, true)
    end
end

-- Initialize dropdown
flingDropdown = FSection:NewDropdown("Select Player", "Pick a player to fling", playerOptions, function(selected)
    selectedPlayer = playerMap[selected]
    notif("Selected: " .. (selectedPlayer and selectedPlayer.Name or "None"))
end)

-- Update dropdown on player join/leave
Players.PlayerAdded:Connect(function()
    task.wait()  -- wait a frame to ensure player fully loads
    updateFlingDropdown()
end)
Players.PlayerRemoving:Connect(updateFlingDropdown)

-- Initial population
updateFlingDropdown()

-- Buttons
FSection:NewButton("Fling Selected Player", "Fling the player you selected", function()
    if selectedPlayer then
        flingPlayer(selectedPlayer)
    else
        notif("No player selected.", 2)
    end
end)

FSection:NewButton("Fling Random Player", "Flings a random player", function()
    local candidates = {}
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= Players.LocalPlayer and p.Character then
            table.insert(candidates, p)
        end
    end

    if #candidates == 0 then
        notif("No valid players to fling!", 2)
        return
    end

    local randomPlayer = candidates[math.random(#candidates)]
    flingPlayer(randomPlayer)
end)
